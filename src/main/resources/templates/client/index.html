<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>SANLAM Assurance Vie | ESPACE CLIENT</title>
    <meta charset="utf-8">
    <meta content="ie=edge" http-equiv="x-ua-compatible">
    <meta content="template language" name="keywords">
    <meta content="Tamerlan Soziev" name="author">
    <meta content="Admin dashboard html template" name="description">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="./img/favico.png" rel="shortcut icon">
    <link href="../apple-touch-icon.png" rel="apple-touch-icon">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500" rel="stylesheet" type="text/css">
    <link href="../bower_components/select2/dist/css/select2.min.css" rel="stylesheet">
    <link href="../bower_components/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <link href="../bower_components/dropzone/dist/dropzone.css" rel="stylesheet">
    <link href="../bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="../bower_components/fullcalendar/dist/fullcalendar.min.css" rel="stylesheet">
    <link href="../bower_components/perfect-scrollbar/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.1.5/css/iziToast.min.css" rel="stylesheet">
    <!--<script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script src="../tchat/app.js"></script>-->
</head>
<body>
<div th:replace="fragments/fragment-banniere-message :: banniere-message"></div>
<div class="menudrop">
    <div class="menudropdiv">
        <p><a href="">Profil</a></p>
        <!--<p><a href="">Paramètres</a></p> -->
        <p><a th:href="@{/disconnect}">Deconnexion</a></p>
    </div>
</div>
<div class="all-wrapper menu-top">
    <div class="layout-w">
        <div th:replace="fragments/fragment-menu-top-image-w :: menu-top-image-w"></div>
        <div class="content-w">
            <div class="content-i">
                <div class="content-box">
                    <div class="row">
                        <div class="col-sm-4 col-xl-2">
                            <div class="element-wrapper">
                                <div style="margin-top:17px;" class="element-box">
                                    <h6 class="element-header last-quittance">
                                        Statut des quittances
                                    </h6>
                                    <div class="el-chart-w" th:if="${isEnterprise}">
                                        <canvas height="120" id="donutChart" width="120"></canvas>
                                        <div class="inside-donut-chart-label">
                                            <strong>A jour</strong><span th:text="${dateLastQuittance} ? 'au '+${#dates.format(dateLastQuittance, 'dd/MM/yyyy')}"></span>
                                        </div>
                                    </div>
                                    <div class="el-chart-w" th:if="${isEnterprise == false}">
                                        <canvas height="120" id="donutChart" width="120"></canvas>
                                        <div class="inside-donut-chart-label">
                                            <strong th:text="${quittances} ? ${#lists.size(quittances)}">220</strong><span>Total</span>
                                        </div>
                                    </div>
                                    <div class="el-legend">
                                        <div class="legend-value-w">
                                            <div class="legend-pin" style="background-color: #6896f9;"></div>
                                            <div class="legend-value">
                                                En Instance
                                            </div>
                                        </div>
                                        <div class="legend-value-w">
                                            <div class="legend-pin" style="background-color: #85c751;"></div>
                                            <div class="legend-value">
                                                Payé
                                            </div>
                                        </div>
                                        <div class="legend-value-w">
                                            <div class="legend-pin" style="background-color: #d97b70;"></div>
                                            <div class="legend-value">
                                                Impayé
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-8 col-xl-6">
                            <div class="element-wrapper">

                                <div style="margin-top:17px;" class="element-box">
                                    <h6 class="element-header product">
                                        Les produits SANLAM Assurance Vie
                                    </h6>
                                    <div class="table-responsive">
                                        <div id="myCarousel" class="carousel slide" data-ride="carousel">
                                            <!-- Indicators -->
                                            <ol class="carousel-indicators">
                                                <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                                                <li data-target="#myCarousel" data-slide-to="1"></li>
                                            </ol>


                                            <!-- Wrapper for slides -->
                                            <div class="carousel-inner" th:if="${isEnterprise == false}">
                                                <div class="item active">
                                                    <img src="../img/ny.jpg" alt="Los Angeles" style="width:100%;">
                                                </div>

                                                <div class="item">
                                                    <img src="../img/ny2.jpg" alt="Chicago" style="width:100%;">
                                                </div>
                                            </div>
                                            <div class="carousel-inner" th:if="${isEnterprise}">
                                                <div class="item active">
                                                    <img src="../img/ifc.jpg" alt="Los Angeles" style="width:100%;">
                                                </div>

                                                <div class="item">
                                                    <img src="../img/pc.jpg" alt="Chicago" style="width:100%;">
                                                </div>
                                                <div class="item">
                                                    <img src="../img/rc.jpg" alt="Chicago" style="width:100%;">
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="padded-lg">
                                <!--START - Projects Statistics-->
                                <div class="element-wrapper">
                                    <div style="margin-top:7px;" class="element-box">
                                        <div class="padded m-b">
                                            <div class="centered-header">
                                                <h6>
                                                    SITUATION ACTUELLE
                                                </h6>
                                            </div>
                                            <div class="row">
                                                <div class="col-6 b-r b-b">
                                                    <div class="el-tablo centered padded-v-big highlight bigger">
                                                        <div class="label" th:if="${isEnterprise == false}">Total <br/>contrats</div>
                                                        <div class="label id-label" th:if="${isEnterprise}">Total <br/>Ahdérents</div>
                                                        <div class="value" th:text="${total_contrat}">24</div>
                                                    </div>
                                                </div>
                                                <div class="col-6 b-b">
                                                    <div class="el-tablo centered padded-v-big highlight bigger" th:if="${isEnterprise == false}">
                                                        <div class="label">
                                                            Cumul global <br/> des impayés
                                                        </div>
                                                        <div class="value"
                                                             th:text="${cumul_impaye} ? ${#numbers.formatInteger(cumul_impaye,3,'POINT')}+' FCFA':'0 FCFA'">
                                                            251
                                                        </div>
                                                    </div>
                                                    <div class="el-tablo centered padded-v-big highlight bigger" th:if="${isEnterprise}">
                                                        <div class="label id-label" th:if="${sitCpteGble}" th:utext="${sitCpteGble?.dateSituation} ? 'Cumul des'+'<br/>'+' cotisations '+${#dates.year(sitCpteGble?.dateSituation)}">
                                                            Cumul des <br/> cotisations
                                                        </div>
                                                        <div class="value"
                                                             th:text="${sitCpteGble?.cotisationAnnuelle} ? ${#numbers.formatInteger(sitCpteGble?.cotisationAnnuelle,3,'POINT')}+' FCFA':'0 FCFA'">
                                                            251
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="padded m-b" th:if="${isEnterprise == false}">
                                            <div class="centered-header">
                                                <h6>
                                                    Derniers contrats
                                                </h6>
                                            </div>
                                            <div th:each="cont,iterStat: ${contratDashboard}"
                                                 th:if="${iterStat.index}<3" class="os-progress-bar primary">
                                                <div class="bar-labels">
                                                    <div class="bar-label-left">
                                                        <span th:text="${cont?.police}">07568974</span>
                                                    </div>
                                                    <div class="bar-label-right">
                                                        <span class="info"
                                                              th:text="${cont?.cumulImpaye} ? ${#numbers.formatInteger(cont?.cumulImpaye,3,'POINT')}+' FCFA'">150.000 FCFA</span>
                                                    </div>
                                                </div>
                                                <div class="bar-level-1" style="width: 100%">
                                                    <div th:attr="data-title=${cont?.cumulPaye} ? ${#numbers.formatInteger(cont?.cumulPaye,3,'POINT')}+' FCFA'"
                                                         data-toggle="tooltip" data-original-title="" title=""
                                                         class="bar-level-3"
                                                         th:style="'width:'+${cont?.percent}+'%'"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="padded m-b" th:if="${isEnterprise}">
                                            <div class="centered-header">
                                                <h6>
                                                    Produits contractés
                                                </h6>
                                            </div>
                                            <div th:each="cont,iterStat: ${sitCpteGble}" class="os-progress-bar primary">
                                                <div class="bar-labels">
                                                    <div class="bar-label-left">
                                                        <span th:text="${cont?.typeContrat}">07568974</span>
                                                    </div>
                                                </div>
                                                <div class="bar-level-1" style="width: 100%">
                                                    <div th:attr="data-title=${cont?.typeContrat}"
                                                         data-toggle="tooltip" data-original-title="" title=""
                                                         class="bar-level-3"
                                                         style="width:100%"></div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <!--END - Projects Statistics-->
                            </div>
                        </div>

                    </div>
                    <div class="element-wrapper">

                        <div class="element-wrapper">

                            <div style="margin-top:17px;" class="element-box" th:if="${isEnterprise == false}">
                                <h6 class="element-header">
                                    Dernières quittances
                                </h6>
                                <div class="table-responsive">
                                    <table class="table table-lightborder">
                                        <thead>
                                        <tr>
                                            <th>Contrats</th>
                                            <th class="text-center">Type produit</th>
                                            <th class="text-center">Date d’effet du contrat</th>
                                            <th class="text-center">Objet</th>
                                            <th class="text-center">echeance</th>
                                            <th class="text-center">Montant emis</th>
                                            <th class="text-center">Montant payé</th>
                                            <th class="text-right">Statut</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="qtce,iterStat: ${quittances}" th:if="${iterStat.index}<5">

                                            <td class="nowrap" th:text="${qtce?.contrat?.police}">107</td>
                                            <td class="text-center"
                                                th:text="${qtce?.contrat?.produit?.branche?.branche}">oki
                                            </td>
                                            <td class="text-center"
                                                th:text="${qtce.contrat.dateEffet} ? ${#dates.format(qtce.contrat.dateEffet, 'dd/MM/yyyy')}">
                                                31/03/2013
                                            </td>
                                            <td class="text-center" th:text="${qtce?.objet?.nomObjet}">107</td>
                                            <td class="text-center"
                                                th:text="${qtce.echeance} ? ${#dates.format(qtce.echeance, 'dd/MM/yyyy')}">
                                                31/03/2013
                                            </td>
                                            <td class="text-center"
                                                th:text="${qtce.montantEmis} ? ${#numbers.formatInteger(qtce.montantEmis,3,'POINT')} : '0'+' FCFA'">
                                                50.000 FCFA
                                            </td>
                                            <td class="text-center"
                                                th:text="${qtce.montantPaye} ? ${#numbers.formatInteger(qtce.montantPaye,3,'POINT')} : '0'+' FCFA'">
                                                50.000 FCFA
                                            </td>
                                            <td class="text-right">
                                                <div th:if="${qtce?.statutQuitance?.statutQuit=='payé'}"
                                                     class="status-pill green" data-title="payé" data-toggle="tooltip"
                                                     data-original-title="payé" title="payé"></div>
                                                <div th:if="${qtce?.statutQuitance?.statutQuit=='impayé'}"
                                                     class="status-pill red" data-title="impayé" data-toggle="tooltip"
                                                     data-original-title="impayé" title="impayé"></div>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div style="margin-top:17px;" class="element-box" th:if="${isEnterprise}">
                                <h6 class="element-header product-contactes">
                                    Produits contractés
                                </h6>
                                <div class="table-responsive">
                                    <table class="table table-lightborder">
                                        <thead>
                                        <tr>
                                            <th class="text-center" >Type contrat</th>
                                            <th class="text-center">Numero contrat</th>
                                            <!--<th class="text-center" th:text="${sitCpteGble?.dateSituation} ? 'Provision mathématique au '+${#dates.format(sitCpteGble?.dateSituation, 'dd/MM/yyyy')} : 'Provision mathématique' ">Provision mathématique</th>-->
                                            <th class="text-center" th:text="${sitCpteGble?.dateSituation} ? 'Provision mathématique au '+${#dates.format(sitCpteGble?.dateSituation, 'dd/MM/')}+''+${#strings.toString(#dates.format(sitCpteGble?.dateSituation, 'yyyy'))} : 'Provision mathématique' ">Provision mathématique</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="product,iterStat: ${sitCpteGble}" th:if="${iterStat.index}<5">

                                            <td class="text-center" th:text="${product?.typeContrat}">oki</td>
                                            <td class="text-center" th:text="${perso?.matricule}">-</td>
                                            <td class="text-center" th:text="${product?.capitalAu} ? ${#numbers.formatInteger(product?.capitalAu,3,'POINT')}+' FCFA':'0 FCFA'">6636026316</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--------------------db_sahamvie_05_06_18@localhost
                   START - Chat Popup Box
                   -------------------->
                    <div class="floated-chat-btn" onclick="connect()">
                        <i class="os-icon os-icon-mail-07"></i><span>Chat</span>
                    </div>
                    <div th:replace="fragments/fragment-floated-chat-w :: chat-w"></div>
                    <!--------------------
                    END - Chat Popup Box
                    -------------------->
                </div>
            </div>

        </div>
    </div>
    <div class="display-type"></div>
</div>
<script src="../bower_components/jquery/dist/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../bower_components/moment/moment.js"></script>
<script src="../bower_components/chart.js/dist/Chart.min.js"></script>
<script src="../bower_components/select2/dist/js/select2.full.min.js"></script>
<!--<script src="../bower_components/ckeditor/ckeditor.js"></script>-->
<script src="../bower_components/bootstrap-validator/dist/validator.min.js"></script>
<script src="../bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<script src="../bower_components/dropzone/dist/dropzone.js"></script>
<script src="../bower_components/editable-table/mindmup-editabletable.js"></script>
<script src="../bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<script src="../bower_components/fullcalendar/dist/fullcalendar.min.js"></script>
<script src="../bower_components/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js"></script>
<script src="../bower_components/tether/dist/js/tether.min.js"></script>
<script src="../bower_components/bootstrap/js/dist/util.js"></script>
<script src="../bower_components/bootstrap/js/dist/alert.js"></script>
<script src="../bower_components/bootstrap/js/dist/button.js"></script>
<script src="../bower_components/bootstrap/js/dist/carousel.js"></script>
<script src="../bower_components/bootstrap/js/dist/collapse.js"></script>
<script src="../bower_components/bootstrap/js/dist/dropdown.js"></script>
<script src="../bower_components/bootstrap/js/dist/modal.js"></script>
<script src="../bower_components/bootstrap/js/dist/tab.js"></script>
<script src="../bower_components/bootstrap/js/dist/tooltip.js"></script>
<script src="../bower_components/bootstrap/js/dist/popover.js"></script>

<!--
    <script src="../js/main.js"></script>
-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<script src="../js/popup.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.1.5/js/iziToast.min.js"></script>
<script src="../js/main.js"></script>
<!--TCHAT-->
<script>
    var stompClient = null;
    var lastMsg="vide";


    function connect() {
        var val = $("#idUsername").val();
        var socket = new SockJS('/gs-guide-websocket');
        stompClient = Stomp.over(socket);
       stompClient.connect({}, function (frame) {
            //setConnected(true);
            console.log('Connected: ' + frame);
            stompClient.subscribe('/topic/greetings', function (greeting) {
                console.log("..........");
                console.log(greeting);
                console.log(".............");
                showGreeting(JSON.parse(greeting.body));
            });
        });

        $.ajax({
            url: '/api/v1/sahamvie/user-message',
            type: 'POST',
            data: 'id=' + val,
            dataType: 'json',
            beforeSend: function () {

            },
            success: function (data) {
                if(!data.response.error){
                    console.log(data);
                    $.each(data.data.messages, function(i, item) {
                        if($("#expediteurUsername").val().toUpperCase() === data.data.messages[i].expediteur.toUpperCase()){
                            $('.chat-messages').append('<div class="message self"><div class="message-content">' + data.data.messages[i].contenu + '</div></div>');
                        }else {
                            if ($("#expediteurUsername").val().toUpperCase() === data.data.messages[i].destinataire.toUpperCase()){
                                $('.chat-messages').append('<div class="message"><div class="message-content">' + data.data.messages[i].contenu + '</div></div>');
                            }
                        }
                    })
                }
                var $messages_w = $('.floated-chat-w .chat-messages');
                $messages_w.scrollTop($messages_w.prop("scrollHeight"));
                $messages_w.perfectScrollbar('update');
                return false;
                //content_middle.html(data)
            },
            complete: function () {
            },
            error: function (jqXHR) {
                //content.html(jqXHR.responseText);
            }
        })
    }

    $('.message-input').on('keypress', function (e) {
        if (e.which == 13) {
            stompClient.send("/app/hello", {}, JSON.stringify({'expediteur': $("#expediteurUsername").val(),'contenu':$(this).val(),'destinataire':$("#destinataireUsername").val()}));
            $(this).val('');
            var $messages_w = $('.floated-chat-w .chat-messages');
            $messages_w.scrollTop($messages_w.prop("scrollHeight"));
            $messages_w.perfectScrollbar('update');
            return false;
        }
    });


    function showGreeting(message) {
        console.log(message);
        var areEqual = $("#expediteurUsername").val().toUpperCase() === message.expediteur.toUpperCase();
        console.log("areEqual =>"+areEqual);
        lastMsg = message.expediteur;
        var areEqual2 = lastMsg.toUpperCase() === message.expediteur.toUpperCase();
        console.log("areEqual2 =>"+areEqual2);

         if(areEqual){
             console.log("identique");
             $('.chat-messages').append('<div class="message self"><div class="message-content">' + message.contenu + '</div></div>');

         }else {
             console.log("different");
             console.log($("#destinataireUsername").val());
             console.log(message.destinataire);
             if ($("#expediteurUsername").val().toUpperCase() === message.destinataire.toUpperCase()){
                 $('.chat-messages').append('<div class="message"><div class="message-content">' + message.contenu + '</div></div>');
             }
         }
    }
    /*    function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
            }
            setConnected(false);
            console.log("Disconnected");
        }*/

    /*    function sendName() {
            stompClient.send("/app/hello", {}, JSON.stringify({'name': $("#name").val()}));
        }


        $(function () {
            $("form").on('submit', function (e) {
                e.preventDefault();
            });
            $( "#connect" ).click(function() { connect(); });
            $( "#disconnect" ).click(function() { disconnect(); });
            $( "#send" ).click(function() { sendName(); });
        });*/
</script>

<script>
    // données globales
    $(document).ready(function () {
        $('#darshboard').addClass("menutopActiv");
        // on récupère les références des différents composants de la page
    });
</script>
<script th:inline="javascript">
    /*<![CDATA[*/

    var isEnterprise = [[${isEnterprise}]];
    var message = [[${message}]];
    var title = [[${title}]];
    var info = [[${info}]];

    var statut_impaye = [[${statut_impaye}]];
    var statut_paye = [[${statut_paye}]];
    var statut_instance = [[${statut_instance}]];

   /* console.log("statut_impaye " + statut_impaye);
    console.log("statut_paye " + statut_paye);
    console.log("statut_instance " + statut_instance);
    console.log("isEnterprise " + isEnterprise);*/

    var success = [[${success}]];

    if (message && title) {
        if (success === true) {
            if (info === true) {
                showInfo(title, message);
            } else {
                if(isEnterprise){
                    showSuccess(title, "Content de vous revoir");
                }else {
                    showSuccess(title, message);
                }
            }
        } else if (success === false) {
            showError(title, message);
        }
    }


    if ($("#donutChart").length) {
        var donutChart = $("#donutChart");

        // donut chart data
        var data = {
            labels: ["Impayés", "En instance", "Payés"],
            datasets: [{
                data: [statut_impaye, statut_instance, statut_paye],
                backgroundColor: ["#f37070", "#5797fc", "#4ecc48"],
                hoverBackgroundColor: ["#f37070", "#5797fc", "#4ecc48"],
                borderWidth: 0
            }]
        };

        // -----------------
        // init donut chart
        // -----------------
        new Chart(donutChart, {
            type: 'doughnut',
            data: data,
            options: {
                legend: {
                    display: false
                },
                animation: {
                    animateScale: true
                },
                cutoutPercentage: 80
            }
        });
    }

    /*]]>*/
</script>
</body>
</html>
